CREATE DATABASE test_readiness_logged;
\c test_readiness_logged
CREATE TABLE t (i int) DISTRIBUTED BY (i);
CREATE EXTENSION diskquota;
WARNING:  [diskquota] diskquota is not ready because current database is not empty
HINT:  please run 'SELECT diskquota.init_table_size_table();' to initialize diskquota
CREATE EXTENSION diskquota_test;
SELECT diskquota_test.wait('SELECT diskquota_test.check_cur_db_status(''UNREADY'');');
 wait 
------
 t
(1 row)

SELECT count(*) FROM gp_toolkit.gp_log_database
WHERE logmessage = '[diskquota] diskquota is not ready';
 count 
-------
     1
(1 row)

\! gpstop -raf > /dev/null
\c
SELECT diskquota_test.wait('SELECT diskquota_test.check_cur_db_status(''UNREADY'');');
 wait 
------
 t
(1 row)

SELECT count(*) FROM gp_toolkit.gp_log_database
WHERE logmessage = '[diskquota] diskquota is not ready';
 count 
-------
     2
(1 row)

DROP EXTENSION diskquota;
\c contrib_regression
DROP DATABASE test_readiness_logged;
